<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Mentor - Pathways</title>
  <meta name="description" content="Ask AI questions about your learning path, get personalized advice and answers." />
  <link rel="icon" href="/favicon.ico" />
  <link rel="stylesheet" href="/css/tailwind-input.css">
  <link rel="stylesheet" href="/css/styles.css">
  <script src="/js/config.js"></script>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 min-h-screen">
  <a href="#main-content" class="skip-link">Skip to main content</a>
  <div data-include="header"></div>

  <main id="main-content" class="container mx-auto px-4 py-8 max-w-6xl">
    <div class="mb-8">
      <h1 class="text-4xl font-bold mb-2">AI Career Assistant</h1>
      <p class="text-xl text-gray-600 dark:text-gray-400">Ask about anything - career paths, skills, learning plans, and more</p>
    </div>
    
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <div class="lg:col-span-1">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4 sticky top-24">
          <h3 class="font-bold mb-4 text-lg">Quick Actions</h3>
          <div class="space-y-2 mb-6">
            <button data-task="qna" class="w-full text-left px-4 py-2 rounded task-btn active bg-blue-600 text-white"> General Q&A</button>
            <button data-task="plan" class="w-full text-left px-4 py-2 rounded task-btn"> 6-Week Plan</button>
            <button data-task="explain" class="w-full text-left px-4 py-2 rounded task-btn"> Skill Explainer</button>
            <button data-task="recommend" class="w-full text-left px-4 py-2 rounded task-btn"> Career Recommender</button>
            <button data-task="compare" class="w-full text-left px-4 py-2 rounded task-btn"> Compare Careers</button>
          </div>
          
          <div class="mt-6 pt-6 border-t border-gray-200 dark:border-gray-700">
            <h4 class="font-semibold mb-2 text-sm">Example Questions</h4>
            <div class="space-y-2 text-sm">
              <button class="example-btn w-full text-left px-3 py-2 text-gray-600 dark:text-gray-400 rounded text-xs">What skills for software engineer?</button>
              <button class="example-btn w-full text-left px-3 py-2 text-gray-600 dark:text-gray-400 rounded text-xs">6-week plan for web dev</button>
              <button class="example-btn w-full text-left px-3 py-2 text-gray-600 dark:text-gray-400 rounded text-xs">Explain JavaScript</button>
              <button class="example-btn w-full text-left px-3 py-2 text-gray-600 dark:text-gray-400 rounded text-xs">Career paths for tech</button>
            </div>
          </div>
        </div>
      </div>
      
      <div class="lg:col-span-2">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg flex flex-col" style="height: 600px;">
          <div id="chat-messages" class="flex-1 overflow-y-auto p-6 space-y-4">
            <div class="text-center text-gray-500 dark:text-gray-400 py-8">
              <p class="text-lg mb-2">Welcome!</p>
              <p class="text-sm">Ask me anything about careers, skills, or learning paths</p>
            </div>
          </div>
          
          <div class="border-t border-gray-200 dark:border-gray-700 p-4">
            <div class="flex gap-2">
              <textarea id="chat-input" rows="2" class="flex-1 px-4 py-2 border rounded-lg bg-white dark:bg-gray-700 resize-none" placeholder="Type your question here..."></textarea>
              <button id="send-btn" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-semibold">Send</button>
            </div>
            <div id="typing-indicator" class="hidden mt-2 text-sm text-gray-500">
              <span class="animate-pulse">AI is thinking...</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <div data-include="footer"></div>
  <script src="/js/gemini.js"></script>
  <script src="/js/seed-test-data.js"></script>
  <script src="/js/include.js" defer></script>
  <script>
  const QA_KEY = "ai_mentor_qa";
  let currentTask = "qna";
  let useGemini = false;
    
    // Initialize Gemini API
    if (window.GeminiAPI) {
      window.GeminiAPI.init();
    }
    
    // Initialize on load
    if (document.readyState === 'loading') {
    document.addEventListener("DOMContentLoaded", function() {
        setupEventListeners();
        checkAPIStatus();
      });
    } else {
      setupEventListeners();
      checkAPIStatus();
    }

    // If ?seed=1 is present, populate fallback AI history (non-destructive)
    (function(){
      const urlParams = new URLSearchParams(window.location.search);
      if (urlParams.get('seed') === '1' && window.SeedTestData && window.SeedTestData.seedAI) {
        const seeded = window.SeedTestData.seedAI(false);
        if (seeded) console.log('AI mentor seeded with sample Q&A');
      }
    })();
    
    function checkAPIStatus() {
      // Silent check: enable Gemini usage automatically if a key exists in localStorage.
      if (window.GeminiAPI && window.GeminiAPI.isConfigured()) {
        useGemini = true;
      } else {
        useGemini = false;
      }
    }
    
    function setupEventListeners() {
      document.querySelectorAll(".task-btn").forEach(btn => {
        btn.addEventListener("click", function() {
          currentTask = this.dataset.task;
          document.querySelectorAll(".task-btn").forEach(b => {
            b.classList.remove("active", "bg-blue-600", "text-white");
            b.classList.add("hover:bg-gray-100", "dark:hover:bg-gray-700");
          });
          this.classList.add("active", "bg-blue-600", "text-white");
          this.classList.remove("hover:bg-gray-100", "dark:hover:bg-gray-700");
        });
      });
      
      document.querySelectorAll(".example-btn").forEach(btn => {
        btn.addEventListener("click", function() {
          const examples = {
            "What skills for software engineer?": "What skills do I need to become a software engineer?",
            "6-week plan for web dev": "Generate a 6-week plan to learn web development",
            "Explain JavaScript": "Explain JavaScript basics",
            "Career paths for tech": "Recommend career paths for technology"
          };
          document.getElementById("chat-input").value = examples[this.textContent] || this.textContent;
          document.getElementById("chat-input").focus();
        });
      });
      
      document.getElementById("send-btn").addEventListener("click", sendMessage);
      document.getElementById("chat-input").addEventListener("keydown", function(e) {
        if (e.key === "Enter" && !e.shiftKey) {
          e.preventDefault();
          document.getElementById("send-btn").click();
        }
      });
    }
    
    async function sendMessage() {
      const input = document.getElementById("chat-input");
      const message = input.value.trim();
      if (!message) return;
      
      addMessage("user", message);
      input.value = "";
      
      document.getElementById("typing-indicator").classList.remove("hidden");
      document.getElementById("send-btn").disabled = true;
      
      try {
        let response = '';
        
  // Try Gemini API if configured (silent, via localStorage)
  if (useGemini && window.GeminiAPI && window.GeminiAPI.isConfigured()) {
          try {
            if (currentTask === "plan") {
              response = await window.GeminiAPI.generateLearningPlan(message);
            } else if (currentTask === "explain") {
              response = await window.GeminiAPI.explainSkill(message);
            } else if (currentTask === "recommend") {
              response = await window.GeminiAPI.recommendCareers(message);
            } else if (currentTask === "compare") {
              const parts = message.split(' vs ');
              if (parts.length === 2) {
                response = await window.GeminiAPI.compare(parts[0], parts[1]);
              } else {
                response = await window.GeminiAPI.generateCareerAdvice(message);
              }
            } else {
              response = await window.GeminiAPI.generateCareerAdvice(message);
            }
          } catch (apiError) {
            console.error('Gemini API error:', apiError);
            response = generateFallbackResponse(message, currentTask);
          }
        } else {
          response = generateFallbackResponse(message, currentTask);
        }
        
        addMessage("assistant", response);
        
        const qa = JSON.parse(localStorage.getItem(QA_KEY) || "[]");
        qa.unshift({q: message, a: response, task: currentTask, time: new Date().toISOString()});
        localStorage.setItem(QA_KEY, JSON.stringify(qa.slice(0, 50)));
      } catch (error) {
        addMessage("assistant", "Sorry, I encountered an error. Please try again.");
        console.error('Error:', error);
      } finally {
        document.getElementById("typing-indicator").classList.add("hidden");
        document.getElementById("send-btn").disabled = false;
        input.focus();
      }
    }
    
    function addMessage(role, content) {
      const messagesDiv = document.getElementById("chat-messages");
      // Remove welcome message if exists
      const welcome = messagesDiv.querySelector('.text-center');
      if (welcome) welcome.remove();
      
      const messageDiv = document.createElement("div");
      messageDiv.className = "flex " + (role === "user" ? "justify-end" : "justify-start");
      
      if (role === "user") {
        messageDiv.innerHTML = '<div class="max-w-xs bg-blue-600 text-white rounded-lg px-4 py-2"><p>' + escapeHtml(content) + '</p></div>';
      } else {
        messageDiv.innerHTML = '<div class="max-w-xs bg-gray-100 dark:bg-gray-700 rounded-lg px-4 py-3"><div class="whitespace-pre-line">' + escapeHtml(content) + '</div></div>';
      }
      
      messagesDiv.appendChild(messageDiv);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }
    
    function generateFallbackResponse(q, task) {
      const lower = q.toLowerCase();
      
      if (task === "plan") {
        return `6-Week Learning Plan: ${q}\n\nWeek 1: Foundations\n* Core concepts\n* Setup environment\n* First project\n\nWeek 2-3: Core Skills\n* Deep dive into fundamentals\n* Practice exercises\n* Build 2-3 projects\n\nWeek 4: Intermediate\n* Advanced topics\n* Real-world applications\n\nWeek 5: Projects\n* Build complete projects\n* Apply all skills\n\nWeek 6: Mastery\n* Refine projects\n* Explore advanced topics\n* Plan next steps\n\nRecommended: 8-10 hours/week`;
      } else if (task === "explain") {
        if (lower.includes("javascript")) {
          return "JavaScript: Programming language for browsers/servers.\n\nKey Concepts:\n- Variables, Functions, Objects, Arrays\n- DOM manipulation\n- ES6+ features (arrow functions, promises)\n\nUsed for: Web development, APIs, React\n\nLearning Path: Basics > DOM > ES6+ > Frameworks";
        } else if (lower.includes("python")) {
          return "Python: Beginner-friendly programming language.\n\nKey Concepts:\n- Variables, Loops, Functions, Lists\n- Object-oriented programming\n- Libraries (NumPy, Pandas)\n\nUsed for: Data science, Web, ML, Scripting\n\nLearning Path: Basics > Data > Functions > OOP > Libraries";
        }
        return `Explanation: ${q}\n\nKey Topics:\n* Core concepts\n* Applications\n* Best practices\n* Learning path`;
      } else if (task === "recommend") {
        return "Recommended Career Paths:\n\n1. Software Engineer\n- Skills: JavaScript, Python, System Design\n- Time: 6-12 months\n- Salary: $80k-$200k+\n\n2. Data Scientist\n- Skills: Python, Statistics, ML\n- Time: 8-12 months\n- Salary: $90k-$180k+\n\n3. Full Stack Developer\n- Skills: Frontend + Backend\n- Time: 12-18 months\n- Salary: $85k-$150k+";
      } else if (task === "compare") {
        return "Comparison:\n\nKey Differences:\n* Feature differences\n* Use cases\n* Learning curve\n* Career prospects\n\nChoose based on your interests and goals.";
      } else {
        if (lower.includes("web")) return "Web Development Path:\nHTML > CSS > JavaScript > React > Backend\n\nTime: 3-6 months basics, 1-2 years proficiency\n\nFocus: Build projects, learn frameworks, practice daily.";
        if (lower.includes("data")) return "Data Science Path:\nPython > Statistics > Machine Learning\n\nTime: 4-8 months to intermediate\n\nFocus: Work with real datasets, build models, learn visualization.";
        if (lower.includes("stuck")) return "When Stuck:\n1. Break problem into smaller parts\n2. Search online resources\n3. Read documentation\n4. Ask in forums\n5. Take a break and return\n6. Pair program\n7. Review fundamentals";
        return "Learning Tips:\n* Set clear goals\n* Find structured resources\n* Practice regularly (8-10 hrs/week)\n* Build projects\n* Join community\n* Be patient and consistent\n* Review regularly";
      }
    }
    
    function escapeHtml(text) {
      const map = {
        "&": "&amp;",
        "<": "&lt;",
        ">": "&gt;",
        '"': "&quot;",
        "'": "&#039;"
      };
      return text.replace(/[&<>"'"]/g, m => map[m]);
    }
  </script>
</body>
</html>
